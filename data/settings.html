<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="favicon.png">
  <link rel="stylesheet" type="text/css" href="style.css">
  <script>
    function toggleNetworkFields() {
      const dhcpChecked = document.getElementById('dhcp').checked;
      const networkFields = document.getElementById('network-fields');
      networkFields.style.display = dhcpChecked ? 'none' : 'block';
    }
    function toggleTokenVisibility() {
      const tokenInput = document.getElementById('githubtoken');
      const toggleBtn = document.getElementById('token-toggle');
      if (tokenInput.type === 'password') {
        tokenInput.type = 'text';
        toggleBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>';
      } else {
        tokenInput.type = 'password';
        toggleBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>';
      }
    }
    function toggleNtpFields() {
      const ntpChecked = document.getElementById('ntp').checked;
      const tzGroup = document.getElementById('timezone-group');
      tzGroup.style.display = ntpChecked ? 'flex' : 'none';
    }
    function resetWiFi() {
      if (confirm('Reset WiFi settings? Device will reboot into AP mode.')) {
        fetch('/reset-wifi', {method: 'POST'})
          .then(() => {
            alert('WiFi reset. Device rebooting...');
            setTimeout(() => window.location.href = '/', 3000);
          });
      }
    }
    window.onload = function() {
      toggleNetworkFields();
      toggleNtpFields();
      document.getElementById('dhcp').addEventListener('change', toggleNetworkFields);
      document.getElementById('ntp').addEventListener('change', toggleNtpFields);
    }
  </script>
</head>
<body class="card-layout">
  <div class="topnav">
    <img src="waacs-logo.png" alt="Waacs Design & Consultancy">
  </div>
  <div class="content">
    <div class="card-grid">
      <div class="card">
        <div class="header">
          <h1><img src="hex100.png" alt="" class="icon-inline">Settings</h1>
          <a href="/" class="card-close">&times;</a>
        </div>
        
        <form action="/settings" method="POST">
          <div class="form-group-row">
            <label for="ssid" class="form-group-label">WiFi</label>
            <input type="text" id="ssid" name="ssid" value="%SSID%" placeholder="WiFi Network" class="form-group-input">
          </div>
          
          <div class="form-group-row">
            <label for="password" class="form-group-label">Password</label>
            <input type="password" id="password" name="password" value="%PASSWORD%" placeholder="••••••••" class="form-group-input">
          </div>
          
          <div class="form-group-checkbox-row">
            <div class="form-group-checkbox-left">
              <input type="checkbox" id="dhcp" name="dhcp" value="on" %DHCP_CHECKED% class="checkbox-inline" onchange="toggleNetworkFields()">
              <label for="dhcp" class="label-inline">Automatic IP address</label>
            </div>
            <button type="button" onclick="resetWiFi()" class="btn-small btn-reset-wifi">Reset WiFi</button>
          </div>
          
          <div id="network-fields">
            <div class="form-group-row">
              <label for="ip" class="form-group-label">IP Address:</label>
              <input type="text" id="ip" name="ip" value="%IP_ADDRESS%" placeholder="172.17.1.159" class="form-group-input">
            </div>
            
            <div class="form-group-row">
              <label for="gateway" class="form-group-label">Gateway:</label>
              <input type="text" id="gateway" name="gateway" value="%GATEWAY%" placeholder="172.17.1.1" class="form-group-input">
            </div>
            
            <div class="form-group-row">
              <label for="netmask" class="form-group-label">Netmask:</label>
              <input type="text" id="netmask" name="netmask" value="%NETMASK%" placeholder="255.255.255.0" class="form-group-input">
            </div>
          </div>
          
          <div class="form-group-checkbox-simple">
            <input type="checkbox" id="debug" name="debug" value="on" %DEBUG_CHECKED% class="checkbox-inline">
            <label for="debug" class="label-inline">Enable Debug options</label>
          </div>
          
          <div id="debug-fields" %DEBUG_DISPLAY%>
            <div class="form-group-row">
              <label for="fw_version" class="form-group-label">FW Version</label>
              <input type="text" id="fw_version" name="fw_version" value="%FW_VERSION%" placeholder="YYYY-M.m.p" class="form-group-input">
            </div>
            
            <div class="form-group-row">
              <label for="fs_version" class="form-group-label">FS Version</label>
              <input type="text" id="fs_version" name="fs_version" value="%FS_VERSION%" placeholder="YYYY-M.m.p" class="form-group-input">
            </div>
            
            <div class="form-group-checkbox-row">
              <div class="form-group-checkbox-left">
                <input type="checkbox" id="gpioviewer" name="gpioviewer" value="on" %GPIOVIEWER_CHECKED% class="checkbox-inline">
                <label for="gpioviewer" class="label-inline">Enable GPIO Viewer</label>
              </div>
              %GPIOVIEWER_BUTTON%
            </div>
            
            <div class="form-group-checkbox-simple">
              <input type="checkbox" id="ota" name="ota" value="on" %OTA_CHECKED% class="checkbox-inline">
              <label for="ota" class="label-inline">Enable OTA Update</label>
            </div>
          </div>
          
          <div class="form-group-checkbox-row">
            <div class="form-group-checkbox-left">
              <input type="checkbox" id="updates" name="updates" value="on" %UPDATES_CHECKED% class="checkbox-inline">
              <label for="updates" class="label-inline">Enable GitHub Update</label>
            </div>
            %UPDATES_BUTTON%
          </div>

          <div class="form-group-checkbox-row">
            <div class="form-group-checkbox-left">
              <input type="checkbox" id="ntp" name="ntp" value="on" %NTP_CHECKED% class="checkbox-inline">
              <label for="ntp" class="label-inline">Enable NTP sync</label>
            </div>
            <div id="timezone-group" style="display: none; align-items: center; gap: 10px;">
              <label for="timezone" style="margin: 0; white-space: nowrap;">Timezone:</label>
              <select id="timezone" name="timezone" style="padding: 6px 10px; border-radius: 4px; border: 1px solid #ccc; background: white; cursor: pointer; min-width: 150px;">
                <option value="UTC">UTC (UTC+0)</option>
                <option value="CET">CET (UTC+1)</option>
                <option value="CEST">CEST (UTC+2)</option>
                <option value="WET">WET (UTC+0)</option>
                <option value="WEST">WEST (UTC+1)</option>
                <option value="GMT">GMT (UTC+0)</option>
                <option value="BST">BST (UTC+1)</option>
                <option value="EST">EST (UTC-5)</option>
                <option value="EDT">EDT (UTC-4)</option>
                <option value="CST">CST (UTC-6)</option>
                <option value="CDT">CDT (UTC-5)</option>
                <option value="MST">MST (UTC-7)</option>
                <option value="MDT">MDT (UTC-6)</option>
                <option value="PST">PST (UTC-8)</option>
                <option value="PDT">PDT (UTC-7)</option>
              </select>
            </div>
          </div>
          
          <div id="updateurl-group" class="form-group-row" %UPDATES_DISPLAY%>
            <label for="updateurl" class="form-group-label">URL</label>
            <input type="text" id="updateurl" name="updateurl" value="%UPDATE_URL%" placeholder="https://api.github.com/repos/..." class="form-group-input">
          </div>
          
          <div id="githubtoken-group" class="form-group-row" %UPDATES_DISPLAY%>
            <label for="githubtoken" class="form-group-label">Token</label>
            <input type="password" id="githubtoken" name="githubtoken" value="%GITHUB_TOKEN%" placeholder="ghp_..." class="form-group-input-short">
            <button type="button" onclick="toggleTokenVisibility()" id="token-toggle" class="token-toggle-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg></button>
          </div>
          
          <hr class="hr-divider">
          
          <div class="form-actions-buttons">
            <div id="file-manager-section" %FILE_MANAGER_VISIBILITY%>
              <a href="/files" class="btn-small btn-width-100">File Manager</a>
              <a href="/i2c" class="btn-small btn-width-100 btn-i2c">I2C Diag</a>
            </div>
            <input type="submit" value="Save Settings" class="btn-small btn-width-100">
          </div>
        </form>
      </div>
    </div>
  </div>
</body>
</html>
